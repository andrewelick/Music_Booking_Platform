<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, intial-scale=1.0">
    <title>Bluff Tour</title>

    <link href="https://fonts.googleapis.com/css?family=Montserrat|Quicksand" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="static/styles.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <style type='text/css'>
      body {
        margin:0;
        padding:0;
        box-sizing: border-box;
      }

        .mobilegridrow-2 {
            display: block;
            overflow: hidden;
            box-sizing: border-box;
            width: 100%;
            padding: 0;
            padding:10px;
            padding-top:20px;
            margin-bottom: 20px;
            text-align: center;
            color: #383838;
            margin: 0 auto;
        }

        .card_header {
          box-sizing: border-box;
          padding: 10px;
          text-align: center;
          font-size: 16px;
          color: #383838;
          border-top-right-radius: 5px;
          border-top-left-radius: 5px;
          box-shadow: 0px 1px 5px 0px rgba(0, 0, 0, 0.15);
        }

        #recentlistingscontainer {
            display: inline-block;
          width: 100%;
          border-radius: 5px;
          background-color: #FFFFFF;
          box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
          float: right;
        }

        #venueshowcasecontainer {
            width: 100%;
            display: inline-block;
            margin: auto;
            margin-bottom: 15px;
            border-radius: 5px;
            background-color: #FFFFFF;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
            float: right;
        }

        .showcase_container {
            box-sizing: border-box;
            width: 100%;
            padding: 10px;
            border-bottom: 1px solid;
            border-color: #d2d2d2;
            font-size: 14px;
            text-align: left;
            overflow: hidden;
        }

        .venue_showcase_picture {
            width: 50px;
            margin-right: 5px;
            border-radius: 100%;
            float: left;
        }

        .venue_showcase_busi_type {
            padding-left: 5px;
            font-size: 12px;
        }

        .showcase_bio {
            font-size: 12px;
        }

        .singlelisting {
          padding: 10px;
          padding-top: 20px;
          border-bottom: 1px solid;
          border-color: #d2d2d2;
          font-size: 14px;
          overflow: hidden;
        }

        .profilepicture_mini {
          box-sizing: border-box;
          width: 45px;
          border-radius: 100px;
          margin-right: 10px;
          float: left;
        }

        .listing_details {
            padding-bottom: 10px;
        }

        .listing_header_title {
            color: blue;
            font-size: 16px;
        }

        .detail_title {
            vertical-align: middle;
        }

        .icon {
            padding-right: 3px;
            height: 13px;
            vertical-align: middle;
        }

        .listing_stats_option {
          margin-top:-5px;
          padding:5px;
          border-radius: 5px;
          font-size:10px;
          background-color:#596B83;
          color:#FFFFFF;
        }

        .more_details_link {
            width: 100;
            padding: 10px;
            color: #328CC1;
            float: right;
            border: 1px solid;
            border-color: #d2d2d2;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bolder;
            text-transform: uppercase;
        }

        .more_details_link:hover {
            text-decoration: none;
            background-color: #efefef;
        }

        #profile_container {
            box-sizing: border-box;
            width: 100%;
            margin-bottom: 20px;
            padding: 10px;
            color: #383838;
            border-bottom: 1px solid;
            border-color: #efefef;
            border-top-right-radius: 5px;
            border-top-left-radius: 5px;
            float: left;
            overflow: hidden;
        }

        .profile_picture_personal {
            height: 40px;
            margin: 5px;
            border-radius: 100%;
            border: 2px solid;
            border-color: #FFFFFF;
            float: left;
        }

        .quick_stats_container {
            box-sizing: border-box;
            margin-top: 3px;
            text-align: left;
            float: center;
            font-size: 12px;
        }

        .profile_quick_link {
            display: inline-block;
            margin-bottom: 4px;
            margin-right: 4px;
            color: #383838;
        }

        .profile_quick_link:hover {
            text-decoration: underline;
        }

        .loading_gif {
            height: 50px;
        }

      /* For Desktop users: */
      @media only screen and (min-width: 800px) {

          .mobilegridrow-2 {
              width: 800px;
              margin: 0 auto;
          }

          #venueshowcasecontainer {
              width: 300px;
              margin-left: 10px;
          }

          #recentlistingscontainer {
              width: 450px;
          }

          .listing_details {
              overflow: hidden
          }
      }

    </style>
  </head>
  <body>
    <!--- Header --->
    {% include "header.html" %}

    <!-- Mobile welcome picture with text -->
    <div class='mobilegridrow-2'>

        <!--- Venues showcase card --->
        <div id="venueshowcasecontainer">

            <!--- Profile container --->
            <div id="profile_container">

                <!--- Profile picture --->
                <a href="/profile">
                    <img class="profile_picture_personal" src="https://{{AWS_BUCKET_NAME}}.s3.us-east-2.amazonaws.com/static/user_pictures/profile_pictures/{% print uid %}_profile.jpg" />
                </a>

                <!--- Profile name --->
                <div style="padding-top: 10px;font-size: 14px;text-transform: capitalize;text-align: left;">
                    <a href="/profile">{% print profile_details[4] %}</a>
                </div>

                <!--- Bidding stats -->
                <div class="quick_stats_container">
                    <a href='/messages' class="profile_quick_link">Messages</a>
                    <a href='/payments' class="profile_quick_link">Payments</a>
                    <a href="/upcomingshows" class="profile_quick_link">Shows/Bids</a>
                </div>

            </div>

            <div style="padding-bottom:10px;font-size:15px;">Venues around Memphis, TN</div>

            <!--- Venue showcase pictures -->
                {% for venue in venue_showcase %}
                <div class="showcase_container" >
                    <a href="/profile?uid={% print venue['busi_uid'] %}">
                        <img src="https://{{AWS_BUCKET_NAME}}.s3.us-east-2.amazonaws.com/static/user_pictures/profile_pictures/{% print venue['busi_uid'] %}_profile.jpg" class="venue_showcase_picture fade"/>
                    </a>

                    <div>
                        <b>{% print venue['busi_name'] %}</b>
                        <font class="venue_showcase_busi_type">- {% print venue['busi_type'] %}</font>
                    </div>

                    <!--- Business bio --->
                    <div class="showcase_bio">{% print venue['busi_bio'] %}</div>

                </div>
                {% endfor %}

                <!--- If there are no venues in your area --->
                {% if venue_showcase|length == 0 %}
                    <div style="padding: 50px;">There are no venues in your area yet! Invite them!</div>
                {% endif %}

        </div>

      <!--- Listing container --->
      <div id="recentlistingscontainer">
          <div class="card_header">Latest listings in Memphis</div>

          <!--- Load in listings --->
          <div id="openListingsContainer"></div>

          <!-- Loading gif -->
          <img class="loading_gif" src="static/loading-spinner.gif" />

      </div>
      <!--- End of listing container --->

    </div>

    {% include 'footer.html' %}

    <script type="text/javascript">

        //Attach loading gif to any ajax call
        $(document).ajaxStart(function() {
            $(".loading_gif").show();
        });

        $(document).ajaxStop(function() {
            $(".loading_gif").hide();
        });

        //Load show postings that are ending soon
        $.ajax({
            async: true,
            type: "POST",
            url: "/show_postings",
            data: {
                "get_all_postings": "check",
            },
            dataType: "json"
        }).done(function(data) {

            if (data['success']) {
                let ending_shows = data['success']

                if (ending_shows.length == 0) {
                    $("#openListingsContainer").html("<div class='empty_box_text' style='font-size: 13px;padding: 10px;'>There are no open shows</div>")
                }
                else {

                    //Loop through each result and format
                    for (i = 0; i < ending_shows.length; i++) {

                        let single_listing = `
                            <!--- Single Past listing --->
                            <div class="singlelisting">

                                <!--- Listing header --->
                                <div class="listing_header" style='text-align:left'>

                                    <!-- Profile picture --->
                                    <a href="/profile?uid=${ending_shows[i].uid}">
                                        <img src="https://{{AWS_BUCKET_NAME}}.s3.us-east-2.amazonaws.com/static/user_pictures/profile_pictures/${ending_shows[i].uid}_profile.jpg" class='profilepicture_mini' />
                                    </a>


                                    <!--- Listing details --->
                                    <div class="listing_details">

                                        <!--- Profile name --->
                                        <a href="/profile?uid=${ending_shows[i].uid}" style="color: blue">
                                            <span class="listing_header_title" style='font-weight:bold;'>${ending_shows[i].business_name}</span>
                                        </a>

                                        <!--- Location --->
                                        <div style="padding-top: 10px;">
                                            <!--- Icon --->
                                            <img class="icon" src="static/placeholder-black.png" />

                                            <font class="detail_title">${ending_shows[i].location}</font>
                                        </div>

                                        <!--- Date --->
                                        <div style="overflow: hidden; padding-top: 10px;">
                                            <!--- Icon --->
                                            <img class="icon" src="static/calendar-black.png" />

                                            <font class="detail_title">
                                                ${ending_shows[i].show_date}
                                                <font style='font-size:11px'>@</font>
                                                ${ending_shows[i].show_time}
                                            </font>

                                        </div>

                                        <div style="margin: auto; margin-top: 7px; padding-top: 7px;overflow: hidden">
                                            <!--- Price --->
                                            <div style="float: left;overflow: hidden; padding-right: 25px;">
                                                <div style="padding-bottom: 5px;">Budget</div>

                                                <font style="font-weight: bold;font-size: 17px;color: #5f9341">$${ending_shows[i].price}</font>
                                            </div>

                                            <!--- Artist Type --->
                                            <div style="float: left;overflow: hidden; padding-right: 25px;">
                                                <div style="padding-bottom: 5px;">Artist</div>

                                                <font style="font-weight: bold;font-size: 17px;">${ending_shows[i].artist_type}</font>
                                            </div>

                                            <!--- Set length --->
                                            <div style="float: left;overflow: hidden;">
                                                <div style="padding-bottom: 5px;">Set length</div>

                                                <font style="font-weight: bold;font-size: 17px;">${ending_shows[i].set_length}</font>
                                            </div>
                                        </div>

                                    </div>

                                    <!--- More details link --->
                                    <a href="/shows?id=${ending_shows[i].show_id}" class="more_details_link">More details</a>

                                </div>

                            </div>
                            <!--- End of Single Past listing --->
                        `


                        $("#openListingsContainer").append(single_listing)
                    }
                }
            }
        });

    </script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no">
    <title>Bluff Tour</title>

    <link href="https://fonts.googleapis.com/css?family=Montserrat|Quicksand" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="static/styles.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <style type='text/css'>
        body {
            margin:0;
            padding:0;
            box-sizing: border-box;
        }

        .mobilegridrow-2 {
            box-sizing: border-box;
            width: 100%;
            padding: 0;
            padding:10px;
            padding-top:20px;
            margin-bottom: 20px;
            text-align: center;
        }

        #showcontainer {
            max-width: 700px;
            margin: auto;
            padding-bottom: 10px;
            border-radius: 5px;
            text-align: left;
            background-color: #ffffff;
            box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.2);
        }

        #venuepicture {
            width: 60px;
            height: 60px;
            border-radius: 100px;
            padding-right: 5px;
            float:left;
        }

        #details_text_container {
            font-size:14px;
            padding-left: 15px;
        }

        #business_details {
            overflow: hidden;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        #show_details_container {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid;
            border-color: #efefef;
        }

        .single_show_details_container {
            padding-bottom: 10px;
            font-size: 15px;
        }

        .show_details_bubble {
            display: inline-block;
            padding: 6px;
            margin-bottom: 2px;
            border: 1px solid;
            border-radius: 5px;
            background-color:#596B83;
            color: #ffffff;
            font-size: 12px;
        }

        .description {
            box-sizing: border-box;
            padding-top: 10px;
            padding-right: 35px;
            font-size: 13px;
            height: 100px;
            overflow: hidden;
        }

        .detail_title {
            vertical-align: middle;
        }

        .icon {
            padding-right: 3px;
            height: 14px;
            vertical-align: middle;
        }

        #make_bid_container {
            max-width: 700px;
            margin: auto;
            margin-top:10px;
            padding-bottom: 10px;
            border-radius: 5px;
            background-color: #FFFFFF;
            box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.2);
        }

        .card_header {
            box-sizing: border-box;
            margin-bottom: 10px;
            padding: 10px;
            text-align: center;
            font-size: 16px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            color: #383838;
            box-shadow: 0px 1px 5px 0px rgba(0, 0, 0, 0.15);
        }

        #profilecontainer {
            padding: 10px;
        }

        #bidscontainer {
            max-width: 700px;
            margin: auto;
            margin-top:10px;
            padding-bottom: 10px;
            border-radius: 5px;
            background-color: #FFFFFF;
            border-color: #d2d2d2;
            box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.2);
        }

        #bid_message {
            margin-top: 10px;
            color: red;
        }

        #single_bid_container {
            text-align: left;
        }

        .singlebid {
            border-bottom: 1px solid;
            padding: 10px;
            min-height: 50px;
            border-color: #e2e2e2;
        }

        .bid_picture {
            display: inline;
            float: left;
            height: 50px;
            width: 50px;
            border-radius: 100px;
        }

        input[type="number"] {
            width: 45px;
            padding: 5px;
            margin: 5px;
            border-radius: 5px;
            font-size: 17px;
            border: 1px solid;
            border-color: #d2d2d2;
        }

        input[type="submit"], button {
            margin-top: 10px;
            padding: 10px;
            width: 200px;
            border-radius: 5px;
            border: 0;
            font-size: 14px;
            background-color: #328CC1;
            color: #FFFFFF;
        }

        a {
            color: blue;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        textarea {
            box-sizing: border-box;
            padding: 10px;
            width: 100%;
            font-family: inherit;
            resize: none;
            border: 0;
            border-radius: 5px;

        }

        .acceptbid {
            padding:6px;
            margin-top:-10px;
            width: 80px;
            float:right;
            border:0px;
            border-radius: 5px;
            color:#FFFFFF;
            background-color:#328CC1;
            font-size: 11px;
        }

        .acceptbid:hover {
            cursor: pointer;
            background-color: #3494cb;
        }

        .deletebid {
            padding:0px;
            float:right;
            border: 0px;
            border-radius: 5px;
            font-size: 12px;
            color: red;
            background-color:#FFFFFF;
        }

        .deletebid:hover {
            cursor: pointer;
            text-decoration: underline;
        }

        .popupcard {
            box-sizing: border-box;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width:100%;
            padding:20px;
            padding-top:30px;
            padding-bottom:30px;
            z-index:99;
            text-align: center;
            background-color:#FFFFFF;
            display:none;
            transition: 0.5s;
            box-shadow: 0 0px 15px 0 #111111;
        }

        .blackbackground {
            position: fixed;
            top: 0px;
            left: 0px;
            z-index:10;
            height:100%;
            width:100%;
            background-color:#000000;
            opacity:.8;
        }

        #confirm_deletebid_container {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }

        #close_confirm_delete {
            position: absolute;
            top:5px;
            right:10px;
            padding:5px;
            color:#000000;
            width: 100%;
        }

        #winner_bid_card {
            max-width: 700px;
            margin: auto;
            margin-top:20px;
            padding:20px;
            border-radius: 5px;
            box-sizing: border-box;
            color: #FFFFFF;
            background: rgb(248,19,213);
            background: linear-gradient(0deg, rgba(248,19,213,1) 0%, rgba(77,158,255,1) 100%);
        }

        #show_more {
            margin: 0 auto;
            width: 90px;
            padding: 10px;
            font-size: 13px;
            border-radius: 5px;
            color: blue;
            text-align: center;
        }

        #show_more:hover {
            cursor: pointer;
            background-color: #efefef;
        }

        @media screen and (min-width: 800px) {

            .mobilegridrow-2 {
                width: 800px;
                margin: 0 auto;
            }

            #details_text_container {
                overflow: hidden;
            }

            #accept_bid_offer {
                width: 500px;
                border-radius: 5px;
            }

            #confirm_deletebid_container {
                width: 400px;
                border-radius: 5px;
            }
        }

    </style>

  </head>
  <body>
    <!--- Header --->
    {% include "header.html" %}

    <!-- Mobile welcome picture with text -->
    <div class='mobilegridrow-2'>

        <!--- Show snapchot --->
        <div id="showcontainer">
            <div class="card_header">Show details</div>

            <!--- Profile container --->
            <div id="profilecontainer">
                <a href="/profile?uid={% print show_details.uid %}">
                    <img src="https://{{AWS_BUCKET_NAME}}.s3.us-east-2.amazonaws.com/static/user_pictures/profile_pictures/{% print show_details.uid %}_profile.jpg" id="venuepicture"/>
                </a>

                <div id="details_text_container">

                    <!--- Business details --->
                    <div class="business_details">

                        <!--- Business Name -->
                        <a href="/profile?uid={% print show_details.uid %}">
                            <font style='color: blue; font-size:19px;'>{% print show_details.business_name %}</font>
                        </a>

                        <!--- Location --->
                        <div style="padding-top: 10px;">
                            <!--- Icon --->
                            <img class="icon" src="static/placeholder-black.png" />

                            <font class="detail_title">{% print show_details.location %}</font>
                        </div>

                        <!--- Date --->
                        <div style="overflow: hidden; padding-top: 10px;">
                            <!--- Icon --->
                            <img class="icon" src="static/calendar-black.png" />

                            <font class="detail_title">
                                {% print show_details.show_date %}
                                <font style='font-size:11px'>@</font>
                                {% print show_details.show_time %}
                            </font>

                        </div>

                    </div>

                    <!--- Show details --->
                    <div id="show_details_container">

                        <div style="padding-bottom: 20px;overflow: hidden">
                            <!--- Price --->
                            <div style="float: left;overflow: hidden; padding-right: 30px;">
                                <div style="padding-bottom: 5px;">Budget</div>

                                <font style="font-weight: bold;font-size: 18px;color: #5f9341">${% print show_details.price %}</font>
                            </div>

                            <!--- Artist Type --->
                            <div style="float: left;overflow: hidden; padding-right: 30px;">
                                <div style="padding-bottom: 5px;">Artist</div>

                                <font style="font-weight: bold;font-size: 18px;">{% print show_details.artist_type %}</font>
                            </div>

                            <!--- Set length --->
                            <div style="float: left;overflow: hidden; padding-right: 30px;">
                                <div style="padding-bottom: 5px;">Set length</div>

                                <font style="font-weight: bold;font-size: 18px;">{% print show_details.set_length %}</font>
                            </div>
                        </div>

                        <!--- Genres -->
                        <div class="single_show_details_container">

                            <div style="padding-bottom: 10px;">
                                <!--- Icon --->
                                <img class="icon" src="static/tag-black-shape.png" />

                                Genres
                            </div>

                            {% for x in show_details.genres %}
                                <div style="background-color: #6eb9f7" class="show_details_bubble">{% print x['genre'] %}</div>
                            {% endfor %}
                        </div>

                        <!--- Perks -->
                        <div class="single_show_details_container">

                            <div style="padding-bottom: 10px;">
                                <!--- Icon --->
                                <img class="icon" src="static/trophy-black.png" />

                                <font class="detail_title">Perks</font>
                            </div>

                            {% for x in show_details.perks %}
                                <div style="background-color: #72b14e" class="show_details_bubble">{% print x['perk'] %}</div>
                            {% endfor %}
                        </div>

                        <!--- Requirements & Set length -->
                        <div class="single_show_details_container">

                            <div style="padding-bottom: 10px;">
                                <!--- Icon --->
                                <img class="icon" src="static/padlock-black.png" />

                                <font class="detail_title">Requirements</font>
                            </div>

                            <!--- Requirements--->
                            {% for x in show_details.requirements %}
                                <div style="background-color: #232f42" class="show_details_bubble">{% print x['requirement'] %}</div>
                            {% endfor %}
                        </div>

                        <!-- Description --->
                        <div class="description">
                            <font style="font-size: 15px">Description</font>
                            <br/>
                            {% print show_details.description %}
                        </div>

                    </div>

                </div>

            </div>
            <!--- End of profile container --->

            <div id="show_more_container">
                <div id="show_more">Show More</div>
            </div>

        </div>
        <!--- End of show snapshot --->

        <!-- If there is a winning bid --->
        {% if winning_bid %}
            <!--- Winner card --->
            <div id="winner_bid_card">

                <!--- If show is by user venue --->
                {% if uid == show_details.uid %}
                    <div style="margin-bottom:10px;">This artist will be performing at your show</div>
                {% else %}
                    <div style="margin-bottom:10px;">An artist has been chosen for this show</div>
                {% endif %}

                <!--- Profile picture --->
                <a href="/profile?uid={% print winning_bid[0] %}"><img src="https://{{AWS_BUCKET_NAME}}.s3.us-east-2.amazonaws.com/static/user_pictures/profile_pictures/{% print winning_bid[0] %}_profile.jpg" style="border-radius:100px;" height=100 width=100 /></a>

                </br>
                <!--- Name --->
                <a href="/profile?uid={% print winning_bid[0] %}" style="color:#FFFFFF">{% print winning_bid[1][0] %}</a>
                <div style="font-size:13px;">Genre: {% print winning_bid[1][1] %}</div>


                {% if account_type == "artist" %}
                    <!--- If winner is user --->
                    {% if uid == winning_bid[0] %}
                        <div style="padding-top:10px;font-size:13px;">You have won this show and are expected to perform at the listed date and time. You will be paid at the date of the show if all requirements are met.</div>
                        <div style="font-size:13px;"><b>Please contact venue if you have any questions or concerns</b></div>
                    </br>
                    {% endif %}
                    <!--- End of winner is user -->

                    </br>
                    <a href="/" style="color:#FFFFFF">Go back to listings</a>
                {% endif %}

                <!--- If show is by venue --->
                {% if uid == show_details.uid %}
                </br>
                <textarea name="send_winner_message" placeholder="Send a message" rows=1 style="padding-right:75px;"></textarea>
                <input type="submit" value="Send" style="margin:0;padding-left:15px;padding-right:15px;padding-bottom:9px;border-top-left-radius:0;border-bottom-left-radius:0;position:relative;top:-40px;float:right;width: auto;background-color:#4d9eff"/>
                {% endif %}
                <!--- End of show is by venue --->

            </div>
            <!--- End of winner card --->

        <!-- If there is no winner --->
        {% else %}

            <!--- Make a bid --->
            {% if account_type == "artist" %}
                <div id="make_bid_container">
                    <div class="card_header">Make a bid</div>

                    <form action="{{ url_for("one_show_page", id=show_details.show_id) }}" method="POST">
                        <label>Enter your price:<input type="number" name="new_bid_price" placeholder="$500" min="50" step="5" required/></label>
                        </br>
                        <font style="position: relative;top:-5px;font-size:11px;color:#383838">Minimum is $50</font>
                        </br>
                        <input type="submit" value="Place Bid" />
                    </form>

                    <div id="bid_message">{{ get_flashed_messages()[0] }}</div>
                </div>
            {% endif %}
            <!--- End of Make a bid --->

            <!--- Bids container --->
            <div id="bidscontainer">
                <div class="card_header">Bids</div>

                <!-- Bids stats --->
                <div style="padding:5px;font-size:14px;">
                    {% if bids_stats[0] == 1 %}
                        <font class="show_details_stats_bubble">1 bid</font>
                    {% elif bids_stats[0] > 0 %}
                        <font>{% print bids_stats[0] %} bids <font style="font-size:11px;color:#383838">ranging from</font> ${% print bids_stats[1] %} - ${% print bids_stats[2] %}</font>
                    {% endif %}
                </div>
                <!-- End of bids stats --->

                <!--- All bids cards --->
                <div id="single_bid_container">
                    {% if bids_info != 0 %}
                        {% for x in bids_info %}

                        <!-- Single bid --->
                        <div class="singlebid" style="font-size:14px;">
                        <!--- Profile picture --->
                        <a href="/profile?uid={% print x[2] %}"><img src="https://{{AWS_BUCKET_NAME}}.s3.us-east-2.amazonaws.com/static/user_pictures/profile_pictures/{% print x[2] %}_profile.jpg" class="bid_picture" /></a>
                        <!--- Name --->
                        <font style="padding-left: 10px;border: 0px solid;"><a href="/profile?uid={% print x[2] %}" style="text-decoration:none;">{% print bidder_details(x[2])[0] %}</a></font>
                        <!--- Bid price --->
                        <font style="float:right;font-size:17px;" class="bid_price" name="{% print x[3] %}">${% print x[3] %}</font>
                        </br>
                        <!--- Artist genre --->
                        <font style="padding-left: 10px;font-size:12px;">Genre: {% print bidder_details(x[2])[1][0] %}</font>

                        </br>

                        <!--- Venue accept bid button --->
                        {% if account_type == "venue" %}
                        <button id="acceptbid" class="acceptbid" name="{% print bidder_details(x[2])[0] %}" value="{% print x[2] %}">Accept offer</button>
                        {% endif %}
                        <!--- End Venue accept bid button --->

                        <!--- Delete bid button --->
                        {% if x[2] == uid %}
                        <span id="deletebidbutton" class="deletebid" onclick="show_confirm_delete_bid()">Delete Bid</span>
                        {% endif %}
                        <!--- End of Delete bid button --->

                        </div>
                        <!-- End of single bid --->
                        </br>
                        {% endfor %}

                    {% else %}
                        <div style="padding:10px;text-align:center">This are currently no bids on this show</div>
                    {% endif %}
                </div>
                <!-- End of all bids card --->

            </div>
            <!--- End of bids container --->

        <!--- End of no winning bid --->
        {% endif %}

    </div>
    <!--- End of Description card --->

    {% include 'footer.html' %}

    <!--- Confirm delete bid card --->
    <div id="confirm_deletebid_container" class="popupcard">
        <div style="margin-bottom:10px;">Are you sure you want to delete this bid?</div>

        <form action="" method="POST">
            <button value="Delete Bid" name="deletebid">Delete bid</button>
        </form>
    </div>
    <!--- End of confirm delete bid card --->

    <!--- Aceept offer by venue --->
    <div id="accept_bid_offer" class="popupcard">
        <!--- Accept offer title --->
        <div style="margin-bottom: 10px;font-size: 14px;;">Accept offer by <b><span id="acceptoffername"></span></b> for this show on <b>{% print show_details.show_date %}</b> at <b>{% print show_details.show_time %}</b></div>

        <!--- Accept offer button --->
        <form action="" method="POST" name="accept_bid_offer">
            <input type="hidden" id="winning_bidder_uid" name="winning_bidder_uid" value="winneruid" />
            <input type="hidden" id="winning_bidder_price" name="winning_bidder_price" value="winnerprice" />
            <button value="Accept Offer" name="acceptoffer">Accept offer</button>
        </form>

        <!--- Disclaimer --->
        <div style='padding-top: 10px;font-size:12px;color:#383838'>Accepting this offer will close bidding for this show and notify artist that they are performing. You will be charged for the agreed amount 24 hours before the scheduled time and all funds will be held by Bluff Tour till the completetion of the show. There is a 24 hour dipute window following the performance to ensure eveything went smoothly.</div>
    </div>
    <!--- End of accept offer by venue --->

    <!--- Black background for acceot bid --->
    <div id="blackbackground" class="blackbackground" style="display:none"></div>
    <!--- End of Black background --->

    <script type="text/javascript">

    //Show delete bid container
    $("#deletebidbutton").click(function() {
        $("#blackbackground").show()
        $("#confirm_deletebid_container").show()
    })

    //Hide delete bid or accept bid container
    $("#blackbackground").click(function() {
        $("#blackbackground").hide()
        $("#confirm_deletebid_container").hide()
        $("#accept_bid_offer").hide()
    })

    //Show the bidding pop up
    $("#acceptbid").click(function() {
        //Name of bidder and uid
        var accept_bidder_name =$(this).attr('name');
        var accept_bidder_uid = $(this).val()
        var accept_bidder_price = $(this).siblings(".bid_price").attr("name")

        $("#blackbackground").show()
        $("#accept_bid_offer").show()

        //Change title name and uid
        $("#acceptoffername").html(accept_bidder_name)
        $("#winning_bidder_uid").val(accept_bidder_uid)
        $("#winning_bidder_price").val(accept_bidder_price)
    })

    //Expand Details
    let desc_height = $(".description")[0].scrollHeight;

    $("#show_more").click(function() {

        //Check text of button
        let button_value = $("#show_more").html()

        if (button_value == "Show More") {
            $("#show_more").html("Show Less")
            $('.description').animate({'height': desc_height})
        }
        else {
            $("#show_more").html("Show More")
            $('.description').animate({'height': '100px'})
        }
    })

    </script>

  </body>
</html>
